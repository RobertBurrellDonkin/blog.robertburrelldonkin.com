---
title: Cheatsheet – Apache Kafka – Admin
slug: "/cheatsheets/kafka/admin"
---

# AdminClient API

## Design Principals

 * **Asynchronous**
    * ```Result``` wrappers for ```Future```
    * Considered complete on the **client** after **Controller** state updated
 * Eventually consistent
    * Success may be returned before change propagated to all brokers
    * Read operations directed to least loaded broker, write to **Controller**
 * **Options** parameter object specific to call
 * **Flat Hierarchy**

## Properties
### Required
 * ```bootstrap.servers```
  * comma-separated ```host:port``` list of brokers
  * at least one required
  * no requirement for all brokers
  * if all listed brokers are down, producer cannot make initial connection to cluster

### Key Parameters
 * ```client.dns.lookup``` special case handling
    * ```resolve_canonical_bootstrap_servers_only``` SASL with single DNS alias
    * ```use_all_dns_ips``` DNS alias listing IPs
 * ```request.timeout.ms``` default **120s** includes retries

## Use Cases
 * Verify that topics have been set up correctly on start-up
    * In particular, compaction
 * Logging topic configuration on error or at start-up
 * Exposing topic configuration as application metric
 * Allowing an application to create clean topics when starting in development mode
 * Exploring consumer groups to troubleshoot
 * Read consumer lag directly via ```listConsumerGroupOffsets```
 * Ad hoc tooling for site recovery by modifying consumer group data
    * modifying offsets only allowed when group is **not active**
 * Collect cluster meta-data metrics
 * Deleting records for legal reasons
 * Triggering leader elections
 * Reassign replicas

## Testing
 * ```MockAdminClient```

---


# REST Proxy
 * Independent component
 * Communicates with
    * cluster
    * schema registry
 * Provides HTTP-based producers and consumers
    * ```JSON``` to
        * full Avro
        * binary
    * good for missing features especially those without good Avro support
 * lower throughput than native
 * caller responsible for batching

## Deployment and Scaling Out
 * multiple instances behind load balancer


---

# Schema Evolution

 * Brokers adopt ```zero-copy```
    * key and values just **bytes**
    * no broker-side validation
    * key architectural advantage
 * Producers and consumers are responsible
 * Need
    * data to be self-describing
    * to manage evolution
    * most often addressed using **schema registry** pattern
        * separate component
        * allows producers and consumers to know when data is invalid

## Confluent Schema Registry
 * Most usual component
 * Apache Avro
    * Good at evolution
    * Binary
    * ```avro-console-consumer```
    * ```avro-console-producer```
 * Producers store schemas in registry
 * Consumers load schemas from registry
 * Reduces message size by including ID for schema.
 * Introduces points for failure
 * Add maintenance
 * Separate deployment
 * Supported
    *```Avro``` **default**
    * ```Protobuf```
    * ```JSON schema```
### Key Features
 * **versioned history**
    * **subject name strategy**
 * **compability management**

### Key Concepts
 * **topic** message key-value pair
 * **schema** key or value format
    * name may differ from topic name
    * **contract** between teams developing producers and teams developing consumers
 * **subject** name scopes schema
    * ```Subject Name Strategy```
        * configured
            * server-wise
            * per topic
    * **default** derived from topic name

### Architecture
 * Independent **deployment**
 * Called from
    * ```Producers```
    * ```Consumers```
 * Assigns globally unique schema ID
    * monotonically increasing
        * written to store
    * not necessarily consecutive
    * by primary node
        * **zombie-primary** protected by batch allocation in store
            * eg GC pause longer than ZooKeeper timeout
                * cf. GC settings
 * Durable schema store
    * special topic used as highly available write log
        * availability
        * durability
        * ordering
        * recoverability
        * should be **compacted**
 * distributed with single primary
    * coordinated by
        * ZooKeeper (deprecated)
        * Kafka (using group protocol)
            * ```kafkastore.connection.url``` **unset**
            * ```kafkastore.bootstrap.servers``` **set**
    * secondary nodes
        * **read only**
        * forwards **writes**
    * high availability
        * common pattern use DNS load balancer round robin
 * multi-datacenter

### Configuration Parameters

 * ```schema-registry.properties```

#### Key
 * ```kafkastore.connection.url``` **deprecated** for primary elections
 * ```leader.eligibility```
    * to upgrade leader election protocol
        * set **false**
        * rolling bounce
        * set **true**
        * rolling bounce
 * ```kafkastore.bootstrap.servers``` leadership election, durable storage **set**
 * ```listeners```
 * ```schema.compatibility.level```
    * ```backward``` **default** read data by latest published schema
    * ```backward_transitive``` read data by all published schema
    * ```none``` permits any evolution
    * ```forward``` latest published schema can read data by new schema
    * ```forward_transitive``` all published schema can read data by new schema
    * ```full```  back and forward compatible latest schema
    * ```full_transitive``` back and forward compatible all schema
 * ```host.name``` advertised
 * ```leader.eligibility```

#### TLS
 * brokers
    * ```kafkastore.ssl.enabled.protocols```
    * ```kafkastore.ssl.protocol```
    * ```kafkastore.ssl.provider```
    * key store
        * ```kafkastore.ssl.key.password```
        * ```kafkastore.ssl.keystore.location```
        * ```kafkastore.ssl.keystore.type```
        * ```kafakstore.ssl.keystore.password```
    * trust store
        * ```kafkastore.ssl.truststore.location```
        * ```kafkastore.ssl.truststore.password```
        * ```kafkastore.ssl.truststore.type```
 * HTTPS
    * ```ssl.protocol```
    * ```ssl.client.auth``` **default** false
    * ```ssl.principal.mapping.rules```
    * key store
        * ```ssl.keystore.location```
        * ```ssl.keystore.type```
        * ```ssl.keystore.password```
        * ```ssl.key.password```
    * trust store
        * ```ssl.truststore.location```
        * ```ssl.truststore.type```
        * ```ssl.truststore.password```

#### SASL
 * ZooKeeper SASL
    * ```zookeeper.set.acl```
 * brokers
    * ```kafkastore.sasl.keberos.service.name```
    * ```kafkastore.sasl.mechanism``` **default** ```GSSAPI```

#### Durable Log
 * ```kafkastore.topic```
    * **default** ```_schemas```
    * **must** be compacted
 * ```kafkastore.topic.replication.factor``` fault tolerance
    * **default** 3
 * ```kafkastore.init.timeout.ms``` includes topic creation time
 * ```kafkastore.security.protocol``` connecting to Kafka
    * ```PLAINTEXT```
    * ```SASL_PLAINTEXT```
    * ```SSL```
    * ```SASL_SSL```
 * ```kafkastore.timeout.ms```

#### Troubleshooting
 * ```debug``` extra logs


### REST API
 * ```GET /subjects```
 * ```GET /subjects/<name>/versions```
 * ```GET /subjects/<name>/versions/<id>```
 * ```GET /subjects/<name>/Versions/latest```